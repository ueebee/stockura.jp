# API ドキュメント

## 概要

このドキュメントでは、株価データ取得・表示システムのAPI仕様について説明します。

## エンドポイント一覧

### 株価データ取得

#### GET /api/v1/stocks/{symbol}

指定された銘柄の株価データを取得します。

**パラメータ**

| パラメータ名 | 型 | 必須 | 説明 |
|------------|------|------|------|
| symbol | string | 必須 | 証券コード（例: "7203"） |
| period | string | 任意 | 期間（デフォルト: "1d"）<br>指定可能な値: "1d", "5d", "1mo", "3mo", "6mo", "1y", "2y", "5y", "10y", "ytd", "max" |
| interval | string | 任意 | データの間隔（デフォルト: "1d"）<br>指定可能な値: "1m", "2m", "5m", "15m", "30m", "60m", "90m", "1h", "1d", "5d", "1wk", "1mo", "3mo" |

**レスポンス**

```json
{
    "symbol": "7203",
    "company_name": "トヨタ自動車",
    "currency": "JPY",
    "data": [
        {
            "date": "2024-03-17T00:00:00Z",
            "open": 3500.0,
            "high": 3550.0,
            "low": 3480.0,
            "close": 3520.0,
            "volume": 1000000
        },
        // ...
    ]
}
```

**エラーレスポンス**

```json
{
    "error": {
        "code": "STOCK_NOT_FOUND",
        "message": "指定された銘柄が見つかりません"
    }
}
```

### 株価データの非同期取得

#### POST /api/v1/stocks/{symbol}/fetch

指定された銘柄の株価データを非同期で取得します。

**リクエストボディ**

```json
{
    "period": "1mo",
    "interval": "1d"
}
```

**レスポンス**

```json
{
    "task_id": "550e8400-e29b-41d4-a716-446655440000",
    "status": "PENDING"
}
```

#### GET /api/v1/tasks/{task_id}

非同期タスクの状態を確認します。

**レスポンス**

```json
{
    "task_id": "550e8400-e29b-41d4-a716-446655440000",
    "status": "SUCCESS",
    "result": {
        "symbol": "7203",
        "company_name": "トヨタ自動車",
        "data": [
            // ...
        ]
    }
}
```

## エラーコード

| エラーコード | HTTPステータス | 説明 |
|------------|--------------|------|
| STOCK_NOT_FOUND | 404 | 指定された銘柄が見つかりません |
| INVALID_PERIOD | 400 | 無効な期間が指定されました |
| INVALID_INTERVAL | 400 | 無効な間隔が指定されました |
| RATE_LIMIT_EXCEEDED | 429 | APIのレート制限を超えました |
| INTERNAL_SERVER_ERROR | 500 | サーバー内部エラーが発生しました |

## レート制限

- 1分間に10リクエストまで
- 1時間に100リクエストまで

レート制限を超えた場合、`429 Too Many Requests`レスポンスが返されます。

## 認証

現在のバージョンでは認証は不要です。将来的なバージョンで認証機能を追加する予定です。

## バージョニング

APIのバージョンはURLパスに含まれています（例: `/api/v1/...`）。

## 変更履歴

### v1.0.0 (2024-03-17)
- 初期リリース
- 基本的な株価データ取得機能
- 非同期データ取得機能 
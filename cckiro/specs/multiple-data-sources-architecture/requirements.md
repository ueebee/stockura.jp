# 複数データソース対応アーキテクチャ要件

## 概要
現在 J-Quants API のみに対応しているアプリケーションを、 yfinance など複数のデータソースに対応できるよう拡張する。
最初のフェーズでは、各データソースのデータ取得と保管を目的とし、抽象化は後のフェーズで行う。

## 現状の課題

### 1. ディレクトリ構成の問題
- `app/infrastructure/external_services/jquants/` にJ-Quants関連のコードが集約
- 他のデータソースを追加する際の配置が不明確
- データソース固有のモデル、マッパー、クライアントが混在する可能性

### 2. モデル名の曖昧さ
- `ListedInfo` がJ-Quants固有なのか汎用なのか不明確
- データソースごとの独自フィールドの管理方法が未定義

### 3. データベース設計
- 現在の `listed_info` テーブルがJ-Quants専用の構造
- 他のデータソースのデータを格納する方法が未定義

## 要件

### 1. ディレクトリ構成の明確化
- データソースごとに独立したディレクトリ構造
- 各データソースのコードが混在しないよう分離
- 例：
  ```
  app/infrastructure/external_services/
    jquants/
    yfinance/
    alphavantage/  # 将来的な拡張
  ```

### 2. 命名規則の統一
- データソース名を含むモデル名（例：`JQuantsListedInfo`、`YfinanceStockInfo`）
- データソース固有のクライアント、マッパーの命名
- テーブル名にもデータソースを反映（例：`jquants_listed_info`、`yfinance_stock_info`）

### 2-1. ファイル名の命名規則統一（拡張要件）
- データソース固有のファイル名にもデータソース名を反映
- 例：
  - `listed_info.py` → `jquants_listed_info.py`
  - `listed_info_repository_interface.py` → `jquants_listed_info_repository_interface.py`
  - `listed_info_dto.py` → `jquants_listed_info_dto.py`
- 利点：
  - ファイル名からデータソースが即座に識別可能
  - 複数データソースのファイルが同一ディレクトリに存在しても混乱しない
  - IDEでのファイル検索時にデータソース別にフィルタリングが容易

### 3. データ保管の設計
- データソースごとに独立したテーブル
- 共通フィールドと固有フィールドの識別
- データの重複を許容（後で統合・抽象化）

### 4. 並行開発の可能性
- 既存のJ-Quants機能に影響を与えない
- 新しいデータソースの追加が独立して可能
- 各データソースの実装者が干渉しない

### 5. 設定管理
- データソースごとの設定を分離
- 環境変数の命名規則（例：`JQUANTS_*`、`YFINANCE_*`）

## 成功基準
1. yfinanceのコードがJ-Quantsから完全に独立している
2. ディレクトリ構造を見ただけでデータソースが識別できる
3. 新しいデータソースの追加時にテンプレートとして参照できる
4. 既存のJ-Quants機能が正常に動作し続ける

## 制約事項
- クリーンアーキテクチャの原則を維持
- 既存のAPIエンドポイントは変更しない
- 最初のフェーズでは抽象化・共通化は行わない（YAGNI原則）
# 特定銘柄モード削除計画

## 1. 概要

日次株価データ手動取得画面から「特定銘柄モード」を一時的に削除し、将来的に改善した形で再実装する計画です。

### 削除理由
- 現在の実装ではページネーション対応が不完全
- 使用頻度が低い機能
- 期間指定モードと特定日モードで基本的なニーズはカバー可能
- 将来的により良い実装で再導入予定

## 2. 現在の実装状況

### 2.1 同期モード（3種類）
1. **特定日モード**: 特定の日付の全銘柄データ取得
2. **特定銘柄モード**: 特定銘柄の時系列データ取得 ← **削除対象**
3. **期間指定モード**: 指定期間の全データ取得

### 2.2 影響を受けるファイル
- `/app/templates/partials/api_endpoints/endpoint_details_daily_quotes.html` - UI実装
- `/app/templates/base.html` - Alpine.js実装（dailyQuotesSyncManagerコンポーネント）
- `/app/api/v1/endpoints/daily_quotes.py` - バックエンドAPI（変更不要）
- `/app/services/daily_quotes_sync_service.py` - サービス層（変更不要）

## 3. 作業計画

### Phase 1: 影響範囲の調査（10分）
1. HTMLテンプレートで特定銘柄モード関連のUI要素を特定
2. JavaScriptコードで特定銘柄モード関連の処理を特定
3. 削除による他機能への影響を確認

### Phase 2: UI実装の削除（20分）
1. `endpoint_details_daily_quotes.html`から：
   - 特定銘柄モードの選択ボタンを削除
   - 特定銘柄モード選択時のフォーム要素を削除
   - 関連するAlpine.jsディレクティブを削除

2. `base.html`のAlpine.jsコンポーネントから：
   - 特定銘柄モード関連の条件分岐を削除
   - submitSync()メソッドの特定銘柄モード処理を削除
   - 不要な変数（codes）を削除

### Phase 3: 動作確認（15分）
1. 特定日モードが正常に動作することを確認
2. 期間指定モードが正常に動作することを確認
3. UIが正しく表示されることを確認
4. コンソールエラーがないことを確認

## 4. 削除対象の詳細

### 4.1 UI要素
```html
<!-- 削除対象: 特定銘柄モードボタン -->
<button @click="selectSyncMode('single_stock')" ...>
    特定銘柄モード
    <p>特定銘柄の時系列データ</p>
</button>

<!-- 削除対象: 特定銘柄モードのフォーム -->
<div x-show="syncMode === 'single_stock'" ...>
    <!-- 銘柄コード入力フィールド -->
    <!-- 対象日入力フィールド -->
</div>
```

### 4.2 JavaScript処理
```javascript
// 削除対象の処理
else if (this.syncMode === 'single_stock') {
    if (this.codes) params.append('codes', this.codes);
    if (this.targetDate) params.append('target_date', this.targetDate);
}
```

## 5. 注意事項

### 5.1 バックエンドは変更しない
- APIエンドポイントは`single_stock`タイプを引き続きサポート
- サービス層の実装も残す
- 将来的な再実装時にバックエンドの変更が不要

### 5.2 データ整合性
- 既存の同期履歴データには影響なし
- `single_stock`タイプの履歴は表示され続ける

### 5.3 ユーザーへの影響
- 特定銘柄のデータが必要な場合は、特定日モードで日付ごとに取得
- または期間指定モードで必要な期間のデータを一括取得

## 6. 将来の再実装案

### 6.1 改善点
1. ページネーション対応の完全実装
2. 複数銘柄の同時指定機能
3. より直感的なUI設計
4. 進捗表示の改善

### 6.2 実装時期
- ユーザーからの要望が増えた時点で再検討
- 他の優先度の高い機能実装後

## 7. リスクと対策

### リスク
1. ユーザーが特定銘柄モードを使用していた場合の混乱
2. 機能削除によるユーザビリティの低下

### 対策
1. 代替手段（期間指定モード）の使用方法を案内
2. 将来的な再実装の予定を明記

## 8. 実装結果

### 8.1 削除した要素
1. **HTMLテンプレート** (`endpoint_details_daily_quotes.html`)
   - 特定銘柄モードのボタンを削除
   - 特定銘柄モード用のフォームフィールドを削除
   - グリッドレイアウトを3列から2列に変更

2. **JavaScript** (`base.html`)
   - `codes`変数を削除
   - `resetForm()`から`codes`のリセット処理を削除
   - `submitSync()`から特定銘柄モードの条件分岐を削除

### 8.2 動作確認項目
- ✅ 特定日モードが正常に動作すること
- ✅ 期間指定モードが正常に動作すること
- ✅ UIレイアウトが正しく表示されること
- ✅ JavaScriptエラーが発生しないこと

---

作成日: 2025-07-17
更新日: 2025-07-17
作成者: Claude
# データ取得機構削除の要件定義書

## 1. 概要

本プロジェクトでは、現在実装されている以下の 3 つのデータ取得機構を削除します：

1. **trades_spec（投資部門別売買状況）**
2. **weekly_margin_interest（週次信用取引残高）**
3. **announcement（決算発表予定）**

これらの機構は、 J-Quants API からデータを取得し、データベースに保存する機能を提供していますが、不要となったため完全に削除します。

## 2. 削除対象

### 2.1 削除するコンポーネント

各機構について、以下のコンポーネントを削除します：

#### ドメイン層
- Entity クラス
- Repository インターフェース

#### アプリケーション層
- DTO クラス
- Use Case クラス
- External Interface（announcement のみ）

#### インフラストラクチャ層
- Database Model クラス
- Repository 実装クラス
- J-Quants Client クラス
- Celery Task

#### プレゼンテーション層
- API エンドポイント

#### その他
- データベースマイグレーションファイル
- テストスクリプト
- デバッグ用スクリプト

### 2.2 削除するデータベーステーブル

以下のテーブルを削除します：
- `trades_spec`
- `weekly_margin_interests`
- `announcements`

## 3. 削除要件

### 3.1 コード削除要件

1. **完全削除**: 上記のコンポーネントに関連するすべてのコードを削除する
2. **インポート削除**: 各種 `__init__.py` ファイルから関連するインポート文を削除する
3. **参照削除**: 他のモジュールからの参照がある場合は適切に削除する
4. **設定削除**: Celery 設定やその他の設定ファイルから関連する設定を削除する

### 3.2 データベース要件

1. **テーブル削除**: 新しいマイグレーションファイルを作成し、関連するテーブルを削除する
2. **インデックス削除**: 関連するインデックスや constraint も削除する
3. **既存データ**: 削除前に既存データのバックアップを推奨（実装外）

### 3.3 API 削除要件

1. **エンドポイント削除**: 以下の API エンドポイントを削除する
   - `/api/v1/trades-spec/*`
   - `/api/v1/weekly-margin-interests/*`
   - `/api/v1/announcements/*`
2. **ルーティング削除**: API ルーターから関連するルートを削除する

### 3.4 Celery 削除要件

1. **タスク削除**: 関連する Celery タスクを削除する
2. **スケジュール削除**: 定期実行設定がある場合は削除する
3. **タスク登録削除**: Celery 設定から関連するタスクの登録を削除する

## 4. 削除しないもの

以下のコンポーネントは削除対象外とします：

1. **既存のマイグレーションファイル**: 履歴の整合性を保つため、既存のマイグレーションファイルは削除せず、新しいマイグレーションで対応
2. **共通コンポーネント**: 他の機能でも使用されている共通コンポーネント（基底クラスなど）

## 5. 作業の注意事項

1. **依存関係の確認**: 削除前に他のモジュールからの依存関係を確認する
2. **段階的削除**: エラーを防ぐため、適切な順序で削除を実施する
3. **コンパイルエラー回避**: 削除後もアプリケーションが正常に起動することを確認する
4. **テスト確認**: 削除後、既存のテストが正常に動作することを確認する

## 6. 成功基準

1. 3 つのデータ取得機構に関連するすべてのコードが削除されている
2. データベースから関連するテーブルが削除されている
3. アプリケーションが正常に起動する
4. 既存の他の機能に影響がない
5. 不要なインポートやデッドコードが残っていない

## 7. リスクと対策

### リスク
- 他の機能が削除対象のコンポーネントに依存している可能性
- 削除順序を誤るとコンパイルエラーが発生する可能性

### 対策
- 事前に依存関係を調査し、影響範囲を特定する
- 適切な削除順序を計画し、段階的に実施する
- 削除後は必ずアプリケーションの起動確認を行う
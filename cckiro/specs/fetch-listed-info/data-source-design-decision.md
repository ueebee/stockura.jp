# データソース設計決定書

## 決定事項

**採用アプローチ: 非抽象化アプローチ（生データ保存）**

## 設計方針

### 1. 基本方針
- API から受け取ったデータは変換せず、そのまま保存する
- データソースとデータ種類を明確に管理する
- 各データソースごとに専用のテーブルを用意する
- 分析時はユーザーが使用するデータソースを意識的に選択する

### 2. メリット
- **データの完全性**: 元データをそのまま保存するため、情報の欠落がない
- **実装のシンプルさ**: 複雑な変換ロジックが不要
- **柔軟な分析**: ユーザーが分析目的に応じて最適なデータソースを選択可能
- **拡張性**: 新しいデータソースの追加が簡単
- **将来性**: 新しい分析ニーズが生じても元データから対応可能

### 3. 実装概要

```python
# J-Quants データ専用テーブル
class JQuantsStockInfo:
    code: str  # 4 桁銘柄コード
    company_name: str
    market_code: str
    sector_33_code: str
    # J-Quants 特有のフィールドをすべて保持

# yfinance データ専用テーブル  
class YFinanceStockInfo:
    ticker: str
    long_name: str
    exchange: str
    sector: str
    # yfinance 特有のフィールドをすべて保持

# データソース管理
class DataSourceRecord:
    source: str  # "jquants", "yfinance"
    data_type: str  # "stock_info", "price"
    fetched_at: datetime
    raw_data: JSON  # 元データをそのまま保存
```

### 4. 運用方針
- 各データソースの特性をドキュメント化する
- 分析用途に応じたデータソース選択ガイドを作成する
- データソース間の差異（更新頻度、カバレッジ等）を明確にする

## 決定理由

1. 本プロジェクトの目的「多様なデータソースからデータを格納し分析する」に最適
2. データの特性を理解した上での分析が可能
3. 初期実装コストが低く、段階的な改善が可能
4. 将来的に必要に応じて共通インターフェースを追加することも可能

## 今後の検討事項

- 必要に応じて、オンデマンドでデータを共通フォーマットに変換する機能の追加
- 複数データソースのデータを統合して分析する際のヘルパー機能
- データソース選択のベストプラクティスの蓄積

---
決定日: 2025-07-28
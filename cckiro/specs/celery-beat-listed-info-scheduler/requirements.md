# 要件ファイル: Celery Beat を用いた listed_info 定期取得機能

## 1. 概要
J-Quants API から listed_info（上場銘柄一覧）データを定期的に取得し、データベースに保存する機能を実装する。

## 2. 機能要件

### 2.1 定期実行機能
- Celery Beat を使用して定期的にタスクを実行できること
- Cron 形式で実行時間を動的に設定できること
- 実行スケジュールはDBからスケジュールとして読み込めること
    - なお複数の実行スケジュールが管理でき、新規登録、修正、削除ができること

### 2.2 データ取得範囲指定
- 実行日時を基準として、以下の期間指定ができること：
  - 昨日から 7 日間前までのデータ
  - 昨日から 30 日間前までのデータ
  - カスタム期間（開始日・終了日を指定）
- デフォルトは昨日のデータ取得とする

### 2.3 パラメーター指定機能
- 以下のパラメーターを指定可能にすること：
  - データ取得日付の範囲（from_date, to_date）
  - 特定銘柄コードのリスト（codes）※指定しない場合は全銘柄
  - 市場区分（market）※指定しない場合は全市場

### 2.4 エラーハンドリング
- API 呼び出し失敗時のリトライ機能（最大 3 回）
- エラー発生時のログ記録
- 部分的な失敗でも処理を継続できること

### 2.5 データ保存
- 取得したデータは PostgreSQL データベースに保存すること
- 既存データとの重複チェックを行い、更新または新規作成を適切に処理すること
- トランザクション管理により、データの整合性を保証すること

## 3. 非機能要件

### 3.1 パフォーマンス
- 大量データ取得時でもメモリ使用量を抑制すること（バッチ処理）
- 並行実行可能なタスクとして実装すること

### 3.2 監視・ログ
- タスクの実行状況をログに記録すること
- 成功/失敗の件数を記録すること
- Celery の管理画面（Flower）で監視可能にすること

### 3.3 設定管理
- スケジュール設定は環境変数で管理できること
- デフォルト値を持ち、環境変数がない場合も動作すること

## 4. 制約事項
- J-Quants API の仕様に準拠すること
- 既存のクリーンアーキテクチャの構造に従うこと
- 非同期処理（asyncio）と互換性を持つこと

<tr id="endpoint-row-{{ endpoint.id }}" class="hover:bg-gray-50 cursor-pointer transition-colors duration-150" 
    hx-get="/data-sources/{{ endpoint.data_source_id }}/endpoints/{{ endpoint.id }}/details"
    hx-target="#endpoint-details"
    hx-trigger="click"
    title="クリックして詳細を表示">
    <td class="px-6 py-4 whitespace-nowrap">
        <div class="text-sm font-medium text-gray-900">{{ endpoint.name }}</div>
        <div class="text-sm text-gray-500">{{ endpoint.http_method }} {{ endpoint.endpoint_path }}</div>
    </td>
    <td class="px-6 py-4 whitespace-nowrap">
        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium
            {% if endpoint.data_type == 'authentication' %}bg-purple-100 text-purple-800
            {% elif endpoint.data_type == 'listed_companies' %}bg-blue-100 text-blue-800
            {% elif endpoint.data_type == 'daily_quotes' %}bg-green-100 text-green-800
            {% elif endpoint.data_type == 'financial_statements' %}bg-yellow-100 text-yellow-800
            {% else %}bg-gray-100 text-gray-800{% endif %}">
            {{ endpoint.data_type }}
        </span>
    </td>
    <td class="px-6 py-4 whitespace-nowrap text-center">
        <span class="text-sm text-gray-900">
            {% set schedule_info = endpoint_schedules.get(endpoint.id) if endpoint_schedules is defined else None %}
            {% if schedule_info and schedule_info.is_enabled %}
                <span class="inline-flex items-center">
                    <svg class="h-4 w-4 mr-1 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    定期実行
                </span>
            {% else %}
                手動のみ
            {% endif %}
        </span>
    </td>
    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
        {% set stats = endpoint_stats.get(endpoint.id) if endpoint_stats is defined else None %}
        {% if stats and stats.last_execution_at %}
            <div>{{ stats.last_execution_at | to_jst }}</div>
            {% if stats.last_error_at and (not stats.last_success_at or stats.last_error_at > stats.last_success_at) %}
                <div class="text-xs text-red-600">エラー</div>
            {% else %}
                <div class="text-xs text-green-600">成功</div>
            {% endif %}
        {% else %}
            <span class="text-gray-500">未実行</span>
        {% endif %}
    </td>
    <td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-900">
        {% set stats = endpoint_stats.get(endpoint.id) if endpoint_stats is defined else None %}
        {% if stats and stats.last_data_count %}
            {{ '{:,}'.format(stats.last_data_count) }}
        {% else %}
            -
        {% endif %}
    </td>
    <td class="px-6 py-4 whitespace-nowrap text-center">
        {% set stats = endpoint_stats.get(endpoint.id) if endpoint_stats is defined else None %}
        {% if stats and stats.total_executions > 0 %}
            {% set success_rate = (stats.successful_executions / stats.total_executions * 100) | round(1) %}
            <div class="flex items-center justify-center">
                <span class="text-sm font-medium
                    {% if success_rate >= 90 %}text-green-600
                    {% elif success_rate >= 70 %}text-yellow-600
                    {% else %}text-red-600{% endif %}">
                    {{ success_rate }}%
                </span>
            </div>
            <div class="text-xs text-gray-500">
                {{ stats.successful_executions }}/{{ stats.total_executions }}
            </div>
        {% else %}
            <span class="text-sm text-gray-500">-</span>
        {% endif %}
    </td>
    <td class="px-6 py-4 whitespace-nowrap text-right text-sm text-gray-500">
        <svg class="h-5 w-5 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
    </td>
</tr>
# JQuantsクライアントラッパーのリファクタリング要件

## 1. 現状の問題点

### 1.1 冗長なラッパークラス
- `JQuantsListedInfoClient`と`JQuantsDailyQuotesClient`が単なるラッパーとして機能している
- これらのクラスは`IAPIClient`インターフェースをラップしているだけで、実質的な価値を提供していない
- 日付型の変換ロジックが重複している

### 1.2 不必要な複雑性
- `JQuantsClientManager`がラッパークライアントのインスタンスを管理している
- 実際のAPIクライアント（`IAPIClient`実装）とラッパークライアントの2層構造が冗長

### 1.3 メンテナンスの困難さ
- 新しいAPIメソッドを追加する際に、複数の箇所を修正する必要がある
- テストが複雑になり、モックの作成が困難

## 2. リファクタリング要件

### 2.1 機能要件
1. **既存の機能を維持**
   - 上場企業情報の取得機能
   - 日次株価データの取得機能
   - 複数データソースの管理機能

2. **APIインターフェースの統一**
   - `IAPIClient`インターフェースを直接利用
   - 日付型の変換処理を適切な場所に集約

3. **後方互換性の確保**
   - 既存のサービスクラスが正常に動作すること
   - APIの呼び出し方法に大きな変更がないこと

### 2.2 非機能要件
1. **シンプルさ**
   - 不要な抽象化レイヤーを削除
   - コードの可読性を向上

2. **テスタビリティ**
   - モックの作成が容易
   - 単体テストの記述が簡単

3. **保守性**
   - 新機能追加時の変更箇所を最小化
   - 責務の明確な分離

## 3. 制約事項

1. **既存のデータフロー維持**
   - `CompanySyncService`と`DailyQuotesSyncService`の動作に影響を与えない
   - データソース管理の仕組みを維持

2. **エラーハンドリング**
   - 現在のエラーハンドリング機構を維持
   - 例外の種類と処理方法を変更しない

3. **パフォーマンス**
   - リファクタリング後もパフォーマンスが低下しないこと

## 4. 成功基準

1. **コード量の削減**
   - ラッパークラスの削除により、コード量が20%以上削減される

2. **テストの簡素化**
   - モックの作成が簡単になり、テストコードが理解しやすくなる

3. **機能の維持**
   - 既存のすべてのテストが成功する
   - リグレッションが発生しない

## 5. スコープ

### 5.1 対象範囲
- `app/services/jquants_client.py`のリファクタリング
- 関連するサービスクラスの修正
- テストコードの更新

### 5.2 対象外
- APIクライアントの実装（`JQuantsAPIClient`）の変更
- データベース層の変更
- 新機能の追加
# Presentation 層クリーンアーキテクチャ改善要件（第 3 回）

## 概要
Presentation 層の責務を明確化し、クリーンアーキテクチャの原則に従った実装を行うための要件を定義します。

## 現状の課題

1. **重複したデータ構造定義**
   - Presentation 層の Pydantic スキーマと Application 層の DTO がほぼ同じ構造を持っている
   - TaskParams と TaskParamsDto のように、同じデータを異なる形で定義

2. **手動でのデータマッピング**
   - エンドポイントごとに API スキーマから DTO への変換を手動実装
   - DTO から API レスポンスへの変換も手動実装
   - 同じ変換ロジックが複数箇所に散在

3. **責務の不明確さ**
   - データ変換ロジックが Presentation 層のエンドポイントに直接実装されている
   - Presentation 層が Application 層の内部構造に依存

4. **保守性の低下**
   - フィールドを追加・変更する際に複数箇所の修正が必要
   - マッピングロジックのテストが困難

## 改善要件

### 1. データ変換の責務を明確化
- Presentation 層のスキーマと Application 層の DTO の変換を専用のコンポーネントで行う
- 変換ロジックをエンドポイントから分離

### 2. 自動マッピング機能の実装
- 同じ名前・型のフィールドは自動的にマッピング
- カスタムマッピングが必要な場合のみ明示的に定義

### 3. Presentation 層の責務を限定
- HTTP リクエスト/レスポンスの処理
- バリデーション
- 認証・認可
- エラーハンドリング
- Application 層への委譲

### 4. 段階的な実装
- 動作する状態を維持しながら段階的に改善
- 既存のテストが通ることを確認

## 制約事項
- 既存の API インターフェースは変更しない
- Application 層の DTO は変更しない（前回の改善で整理済み）
- 段階的に実装し、各段階で動作確認を行う

## 成功基準
1. エンドポイントからデータ変換ロジックが分離されている
2. 新しいフィールド追加時の変更箇所が最小限になる
3. Presentation 層が Application 層の内部実装に依存しない
4. 既存のテストがすべて通る
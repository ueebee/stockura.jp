# Presentation 層のクリーンアーキテクチャ改善 - 要件定義書（第 1 回：依存性注入の改善）

## 1. 背景

現在のプレゼンテーション層は、クリーンアーキテクチャの原則に完全に従っていない部分があり、以下の問題が存在します：

- プレゼンテーション層がインフラストラクチャ層の具体的な実装に直接依存している
- 依存性注入の仕組みが不十分で、各エンドポイントで実装を直接インスタンス化している

## 2. 改善の目的（第 1 回）

- クリーンアーキテクチャの原則に従い、依存性の方向を適切に管理する
- プレゼンテーション層を他の層から独立させ、テスタビリティと保守性を向上させる
- 依存性注入を適切に実装し、コードの再利用性を高める

## 3. 要件（第 1 回：依存性注入の改善のみ）

### 3.1 依存性注入の改善

- **要件 3.1.1**: プレゼンテーション層はインターフェースに依存し、具体的な実装に依存してはならない
- **要件 3.1.2**: 依存性注入のためのファクトリー/プロバイダーを`presentation/dependencies`に集約する
- **要件 3.1.3**: FastAPI の Depends を使用した依存性注入を統一的に実装する

## 4. 制約事項

- 既存の API インターフェース（エンドポイント、リクエスト/レスポンス形式）は変更しない
- 既存のテストが全て通ることを保証する
- 他の層（Domain 、 Application 、 Infrastructure）の変更は最小限に留める
- 動作する状態を維持しながら段階的に改善する

## 5. 成功基準（第 1 回）

- プレゼンテーション層がインフラストラクチャ層の具体的な実装を直接インポートしていない
- 依存性注入が統一的に実装されている
- 既存のテストが全て通る

## 6. 対象範囲（第 1 回）

以下のエンドポイントの依存性注入を改善する：
- `/api/v1/schedules` - スケジュール管理エンドポイント
- `/api/v1/auth` - 認証エンドポイント
- `/api/v1/listed-info-schedules` - 上場銘柄情報スケジュール管理エンドポイント

## 6. 優先順位

1. 依存性注入の仕組みの整備（最優先）
2. 既存エンドポイントの依存性注入への移行
3. レスポンス変換ロジックの共通化
4. インフラストラクチャ詳細の隠蔽

---

この要件に問題がないか確認してください。問題がある場合は、修正すべき点を教えてください。